{% extends "base.html" %}

{% block title %}{% if mode == 'edit' %}Edit Interview Type{% else %}New Interview Type{% endif %} - Boswell{% endblock %}

{% block head %}
<style>
    .page-header { padding-top: 2rem; margin-bottom: 2rem; }
    .form-card { max-width: 680px; }
    .form-section { margin-bottom: 2rem; }
    .form-section-title { font-family: var(--font-display); font-size: 1.25rem; font-weight: 500; color: var(--fg); margin-bottom: 0.5rem; }
    .form-section-desc { color: var(--fg-dim); font-size: 0.875rem; margin-bottom: 1.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; font-size: 0.875rem; font-weight: 500; color: var(--fg); margin-bottom: 0.5rem; }
    .form-group .required { color: var(--accent); }
    .form-hint { font-size: 0.8125rem; color: var(--fg-dim); margin-top: 0.5rem; }
    .form-divider { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }
    input[type="number"] { max-width: 140px; }
    .submit-btn { width: 100%; padding: 1rem 1.5rem; font-size: 1rem; }
    .custom-angle-input { margin-top: 1rem; display: none; }
    .custom-angle-input.visible { display: block; }
    .file-upload { border: 2px dashed var(--border); border-radius: var(--radius-md); padding: 1.5rem; text-align: center; cursor: pointer; transition: all var(--transition-fast); }
    .file-upload:hover { border-color: var(--accent); background-color: var(--accent-subtle); }
    .file-upload input[type="file"] { border: none; padding: 0; background: transparent; }
    .file-upload-label { display: block; color: var(--fg-muted); font-size: 0.875rem; margin-bottom: 0.5rem; }
</style>
{% endblock %}

{% block body %}
<nav class="nav">
    <div class="nav-content">
        <a href="/admin/" class="nav-brand">Boswell x EMIR</a>
        <div class="nav-links">
            <a href="/admin/">Projects</a>
            <a href="/admin/templates" class="active">Interview Types</a>
            <a href="/admin/settings">Settings</a>
            <span class="text-muted">{{ user.name }}</span>
            <form method="post" action="/admin/logout" style="display: inline;">
                <button type="submit">Logout</button>
            </form>
        </div>
    </div>
</nav>

<div class="container">
    <div class="page-header">
        <a href="/admin/templates" class="back-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
            </svg>
            Back to Interview Types
        </a>
    </div>

    <div class="card form-card">
        <h1 style="font-family: var(--font-display); font-size: 2rem; font-weight: 400; margin-bottom: 2rem;">{% if mode == 'edit' %}Edit Interview Type{% else %}New Interview Type{% endif %}</h1>

        <form method="post" action="{% if mode == 'edit' %}/admin/templates/{{ template.id }}/edit{% else %}/admin/templates/new{% endif %}" enctype="multipart/form-data">
            <div class="form-section">
                <h3 class="form-section-title">Template Info</h3>

                <div class="form-group">
                    <label for="name">Name <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required placeholder="Customer Discovery" value="{% if template %}{{ template.name }}{% endif %}">
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="2" placeholder="Brief description of this interview type">{% if template and template.description %}{{ template.description }}{% endif %}</textarea>
                    <p class="form-hint">Helps you remember what this template is for.</p>
                </div>

                <div class="form-group">
                    <label for="default_minutes">Default Duration (minutes)</label>
                    <input type="number" id="default_minutes" name="default_minutes" value="{% if template %}{{ template.default_minutes }}{% else %}30{% endif %}" min="5" max="120" required>
                </div>
            </div>

            <hr class="form-divider">

            <div class="form-section">
                <h3 class="form-section-title">Content</h3>
                <p class="form-section-desc">Questions and research materials for interviews using this template.</p>

                <div class="form-group">
                    <label for="questions_text">Questions</label>
                    <textarea id="questions_text" name="questions_text" rows="6" placeholder="What drew you to this field?&#10;Can you describe a typical day?&#10;What challenges do you face?&#10;(one question per line)">{% if template and template.questions %}{% for q in template.questions.get('questions', []) %}{{ q.get('text', q) }}{% if not loop.last %}
{% endif %}{% endfor %}{% endif %}</textarea>
                    <p class="form-hint">One question per line. These guide the interview conversation.</p>
                </div>

                <div class="form-group">
                    <label for="research_urls">Research Links</label>
                    <textarea id="research_urls" name="research_urls" rows="3" placeholder="https://example.com/background&#10;https://example.com/context&#10;(one URL per line)">{% if template and template.research_links %}{% for url in template.research_links %}{{ url }}{% if not loop.last %}
{% endif %}{% endfor %}{% endif %}</textarea>
                    <p class="form-hint">URLs to scrape for background context.</p>
                </div>

                <div class="form-group">
                    <label for="research_files">Upload Documents</label>
                    <div class="file-upload">
                        <span class="file-upload-label">PDFs, text files, markdown</span>
                        <input type="file" id="research_files" name="research_files" multiple accept=".pdf,.txt,.md,.doc,.docx">
                    </div>
                    <p class="form-hint">Briefings, research notes, background documents.</p>
                </div>
            </div>

            <hr class="form-divider">

            <div class="form-section">
                <h3 class="form-section-title">Interview Style</h3>
                <p class="form-section-desc">How should Boswell approach interviews using this template?</p>

                <div class="form-group">
                    <label for="angle">Approach <span class="required">*</span></label>
                    <select id="angle" name="angle" onchange="toggleCustomAngle()">
                        <option value="exploratory" {% if not template or not template.angle or template.angle.value == 'exploratory' %}selected{% endif %}>Exploratory - learn from guest, probe deeper</option>
                        <option value="interrogative" {% if template and template.angle and template.angle.value == 'interrogative' %}selected{% endif %}>Interrogative - challenge claims, stress-test</option>
                        <option value="imaginative" {% if template and template.angle and template.angle.value == 'imaginative' %}selected{% endif %}>Imaginative - creative collaboration, "what if"</option>
                        <option value="documentary" {% if template and template.angle and template.angle.value == 'documentary' %}selected{% endif %}>Documentary - capture story, let them lead</option>
                        <option value="coaching" {% if template and template.angle and template.angle.value == 'coaching' %}selected{% endif %}>Coaching - facilitate insight, Socratic</option>
                        <option value="custom" {% if template and template.angle and template.angle.value == 'custom' %}selected{% endif %}>Custom</option>
                    </select>

                    <div id="custom-angle-input" class="custom-angle-input {% if template and template.angle and template.angle.value == 'custom' %}visible{% endif %}">
                        <textarea id="angle_custom" name="angle_custom" rows="4" placeholder="Describe how Boswell should approach these interviews...">{% if template and template.angle_custom %}{{ template.angle_custom }}{% endif %}</textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label for="angle_secondary">Blend with (optional)</label>
                    <select id="angle_secondary" name="angle_secondary">
                        <option value="">None</option>
                        <option value="exploratory" {% if template and template.angle_secondary and template.angle_secondary.value == 'exploratory' %}selected{% endif %}>Exploratory</option>
                        <option value="interrogative" {% if template and template.angle_secondary and template.angle_secondary.value == 'interrogative' %}selected{% endif %}>Interrogative</option>
                        <option value="imaginative" {% if template and template.angle_secondary and template.angle_secondary.value == 'imaginative' %}selected{% endif %}>Imaginative</option>
                        <option value="documentary" {% if template and template.angle_secondary and template.angle_secondary.value == 'documentary' %}selected{% endif %}>Documentary</option>
                        <option value="coaching" {% if template and template.angle_secondary and template.angle_secondary.value == 'coaching' %}selected{% endif %}>Coaching</option>
                    </select>
                    <p class="form-hint">Add a secondary style to blend with the primary approach.</p>
                </div>
            </div>

            <button type="submit" class="btn submit-btn">{% if mode == 'edit' %}Update Interview Type{% else %}Create Interview Type{% endif %}</button>
        </form>
    </div>
</div>

<script>
function toggleCustomAngle() {
    const customInput = document.getElementById('custom-angle-input');
    const angleSelect = document.getElementById('angle');
    if (angleSelect.value === 'custom') {
        customInput.classList.add('visible');
    } else {
        customInput.classList.remove('visible');
    }
}
</script>
{% endblock %}
